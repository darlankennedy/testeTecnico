<VirtualHost _default_:443>
    Options -Indexes
    LimitRequestFieldSize 9000000
    Protocols h2 http/1.1

    SSLEngine On
    ServerSignature On
    SSLVerifyDepth 10
    SSLCertificateChainFile /etc/apache2/conf.cert/voxtecnologia/gd_bundle.crt
    SSLCertificateFile /etc/apache2/conf.cert/voxtecnologia/voxtecnologia.com.br.crt
    SSLCertificateKeyFile /etc/apache2/conf.cert/voxtecnologia/voxtecnologia.com.br.key
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
    SSLOptions +FakeBasicAuth -StrictRequire
    SSLVerifyClient none
    SSLOptions +StdEnvVars -ExportCertData

    SetEnvIf Origin "^(.*)" ORIGIN_SUB_DOMAIN=$1
    Header set Access-Control-Allow-Credentials "true"
    Header set Access-Control-Allow-Origin "%{ORIGIN_SUB_DOMAIN}e" env=ORIGIN_SUB_DOMAIN
    Header set Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
    Header set Access-Control-Allow-Headers "*"

    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://php-v2:9000"
    </FilesMatch>

    DocumentRoot /Navi/public
    <Directory /Navi/public>
        AllowOverride None
        Require all granted

        <IfModule mod_rewrite.c>
            Options -MultiViews
            RewriteEngine On

            RewriteRule .* - [e=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

            RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
            RewriteRule ^(.*) - [E=BASE:%1]
            RewriteCond %{REQUEST_FILENAME} -f

            RewriteRule .? - [L]
            RewriteRule .? %{ENV:BASE}/index.php [L]
        </IfModule>
    </Directory>

    <Files ~ "\.(inc|ini)$">
        Require all denied
    </Files>

    <Files .htaccess>
        Require all denied
    </Files>

</VirtualHost>
